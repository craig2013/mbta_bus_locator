<div class="predictions-header">
	<h1 class="predictions-title">Bus Predictions </h1>
</div>
<div class="bus-predictions">
	<a href="#" class="show-map-link">Show Map</a>
	<a href="#" class="hide-map-link">Hide Map</a>
	<% if ( predictions !== null ) { %>
		<% if ( Array.isArray(predictions) ) { %>
			<% _.each(predictions, function(pre, i) { %>
				<% if ( pre.route_name === Backbone.app.defaults.route ) { %>
					<div class="bus-predictions-sub-header">Predictions for route <%= pre.route_name %>:</div>
					<% if ( Array.isArray(pre.direction) ) { %>
						<% if ( Array.isArray(pre.direction[0].trip) ) { %>
							<% _.each(pre.direction[0].trip, function(t, j) { %>		
								<% if ( j === 0 ) { %>
									<div class="next-vehicle">
								<% } else { %>
									<div class="later-vehicle">
								<% } %>
								<%  if ( convertTime(t.pre_away) > 1 ) { %>
									<%= convertTime(t.pre_away) %> min
								<% } else if ( (convertTime(t.pre_away) === 1) && (i===0) ) { %>
									Your bus is arriving.
								<% } else if ( (convertTime(t.pre_away) === 0) && (i===0) ) { %>
									Your bus is boarding.
								<% } %>
								</div>												
							<% }); %>
						<% } %>
					<% } %>
				<% } else if ( pre.route_name !== Backbone.app.defaults.route ) { %>
					<% if ( i === 1 ) { %>
					<hr/>
					<div class="bus-predictions-sub-header">Predictions for other routes at this stop:</div>
					<% } %>
					<% if ( Array.isArray(pre.direction) ) { %>
						<% if ( Array.isArray(pre.direction[0].trip) ) { %>
							<% _.each(pre.direction[0].trip, function(t, j) { %>
								<div class="later-vehicle">
								<% if ( convertTime(t.pre_away) > 1 ) { %>
									<%= convertTime(t.pre_away) %>
								<% } else if ( (convertTime(t.pre_away) > 0) || (convertTime(t.pre_away) === 1) ) { %>
									Arriving
								<% } %>
								 min (<%= pre.route_name %> <%= t.trip_headsign %>)
								</div>												
							<% }); %>
						<% } %>
					<% } %>					
				<% } %>
			<% }); %>
			<% if ( typeof alert === "string" ) { %>
				<h2>Alert: <%= alert %></h2>
			<% } %>			
		<% } %>
	<% } else if ( (predictions === null) && (typeof alert === "string") ) { %>
		<h2><%= alert %></h2>
	<% } %>
</div>
